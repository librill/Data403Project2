AMT_ANNUITY,
AMT_GOODS_PRICE,
EDUCATION_TYPE_SECONDARY,
EDUCATION_TYPE_HIGHER,
EDUCATION_TYPE_OTHER,
FAMILY_STATUS_MARRIED,
FAMILY_STATUS_SINGLE,
FAMILY_STATUS_OTHER,
HOUSING_TYPE_OWN,
HOUSING_TYPE_PARENTS,
HOUSING_TYPE_OTHER,
DAYS_EMPLOYED,
DOCUMENTS_FLAGGED,
TARGET
)
head(credit)
library(tidyverse)
library(dplyr)
library(corrplot)
knitr::opts_chunk$set(echo = TRUE)
install.packages("corrplot")
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(dplyr)
library(corrplot)
# load dataframe
all_credit <- read_csv(here::here("Data", "application_train.csv"))
# aggregate documents flagged, one-hot-encode, and select columns,
credit <- all_credit %>%
mutate(
DOCUMENTS_FLAGGED = rowSums(select(., starts_with("FLAG_DOCUMENT")))
) %>%
mutate(
CONTRACT_TYPE_CASH = ifelse(NAME_CONTRACT_TYPE=="Cash loans", 1, 0),
CONTRACT_TYPE_REVOLVING = ifelse(NAME_CONTRACT_TYPE=="Revolving loans", 1, 0),
EDUCATION_TYPE_SECONDARY = ifelse(NAME_EDUCATION_TYPE=="Secondary / secondary special", 1, 0),
EDUCATION_TYPE_HIGHER = ifelse(NAME_EDUCATION_TYPE=="Higher education", 1, 0),
EDUCATION_TYPE_OTHER = ifelse(!NAME_EDUCATION_TYPE %in% c("Secondary / secondary special", "Higher education"), 1, 0),
FAMILY_STATUS_MARRIED = ifelse(NAME_FAMILY_STATUS=="Married", 1, 0),
FAMILY_STATUS_SINGLE = ifelse(NAME_FAMILY_STATUS=="Single / not married", 1, 0),
FAMILY_STATUS_OTHER = ifelse(!NAME_FAMILY_STATUS %in% c("Married", "Single / not married"), 1, 0),
HOUSING_TYPE_OWN = ifelse(NAME_HOUSING_TYPE=="House / apartment", 1, 0),
HOUSING_TYPE_PARENTS = ifelse(NAME_HOUSING_TYPE=="With parents", 1, 0),
HOUSING_TYPE_OTHER = ifelse(!NAME_HOUSING_TYPE %in% c("House / apartment", "With parents"), 1, 0),
FLAG_OWN_CAR = ifelse(FLAG_OWN_CAR =="Y", 1, 0),
FLAG_OWN_REALTY = ifelse(FLAG_OWN_REALTY=="Y", 1, 0)
) %>%
select (
SK_ID_CURR,
CONTRACT_TYPE_CASH,
CONTRACT_TYPE_REVOLVING,
FLAG_OWN_CAR,
FLAG_OWN_REALTY,
CNT_CHILDREN,
AMT_INCOME_TOTAL,
AMT_CREDIT,
AMT_ANNUITY,
AMT_GOODS_PRICE,
EDUCATION_TYPE_SECONDARY,
EDUCATION_TYPE_HIGHER,
EDUCATION_TYPE_OTHER,
FAMILY_STATUS_MARRIED,
FAMILY_STATUS_SINGLE,
FAMILY_STATUS_OTHER,
HOUSING_TYPE_OWN,
HOUSING_TYPE_PARENTS,
HOUSING_TYPE_OTHER,
DAYS_EMPLOYED,
DOCUMENTS_FLAGGED,
TARGET
)
head(credit)
credit |>
count(TARGET)
credit |>
count(TARGET) |>
ggplot(aes(x = factor(TARGET), y = n)) +
geom_col() +
geom_text(aes(label = n), vjust = 0.5) +
labs(x = "Target", y = "Count", title = "Distribution of Loan Default")
knitr::opts_chunk$set(echo = TRUE)
install.packages("ggridges")
library(tidyverse)
library(dplyr)
library(corrplot)
library(ggridges)
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(dplyr)
library(corrplot)
library(ggridges)
# load dataframe
all_credit <- read_csv(here::here("Data", "application_train.csv"))
# aggregate documents flagged, one-hot-encode, and select columns,
credit <- all_credit %>%
mutate(
DOCUMENTS_FLAGGED = rowSums(select(., starts_with("FLAG_DOCUMENT")))
) %>%
mutate(
CONTRACT_TYPE_CASH = ifelse(NAME_CONTRACT_TYPE=="Cash loans", 1, 0),
CONTRACT_TYPE_REVOLVING = ifelse(NAME_CONTRACT_TYPE=="Revolving loans", 1, 0),
EDUCATION_TYPE_SECONDARY = ifelse(NAME_EDUCATION_TYPE=="Secondary / secondary special", 1, 0),
EDUCATION_TYPE_HIGHER = ifelse(NAME_EDUCATION_TYPE=="Higher education", 1, 0),
EDUCATION_TYPE_OTHER = ifelse(!NAME_EDUCATION_TYPE %in% c("Secondary / secondary special", "Higher education"), 1, 0),
FAMILY_STATUS_MARRIED = ifelse(NAME_FAMILY_STATUS=="Married", 1, 0),
FAMILY_STATUS_SINGLE = ifelse(NAME_FAMILY_STATUS=="Single / not married", 1, 0),
FAMILY_STATUS_OTHER = ifelse(!NAME_FAMILY_STATUS %in% c("Married", "Single / not married"), 1, 0),
HOUSING_TYPE_OWN = ifelse(NAME_HOUSING_TYPE=="House / apartment", 1, 0),
HOUSING_TYPE_PARENTS = ifelse(NAME_HOUSING_TYPE=="With parents", 1, 0),
HOUSING_TYPE_OTHER = ifelse(!NAME_HOUSING_TYPE %in% c("House / apartment", "With parents"), 1, 0),
FLAG_OWN_CAR = ifelse(FLAG_OWN_CAR =="Y", 1, 0),
FLAG_OWN_REALTY = ifelse(FLAG_OWN_REALTY=="Y", 1, 0)
) %>%
select (
SK_ID_CURR,
CONTRACT_TYPE_CASH,
CONTRACT_TYPE_REVOLVING,
FLAG_OWN_CAR,
FLAG_OWN_REALTY,
CNT_CHILDREN,
AMT_INCOME_TOTAL,
AMT_CREDIT,
AMT_ANNUITY,
AMT_GOODS_PRICE,
EDUCATION_TYPE_SECONDARY,
EDUCATION_TYPE_HIGHER,
EDUCATION_TYPE_OTHER,
FAMILY_STATUS_MARRIED,
FAMILY_STATUS_SINGLE,
FAMILY_STATUS_OTHER,
HOUSING_TYPE_OWN,
HOUSING_TYPE_PARENTS,
HOUSING_TYPE_OTHER,
DAYS_EMPLOYED,
DOCUMENTS_FLAGGED,
TARGET
)
head(credit)
credit %>%
ggplot(aes(x = AMT_INCOME_TOTAL, y = factor(TARGET), fill = factor(TARGET))) +
geom_density_ridges(alpha=0.7) +
scale_x_log10() +
labs(title="Income Distribution by Default Status")
credit %>%
ggplot(aes(x = AMT_INCOME_TOTAL, y = factor(TARGET), fill = factor(TARGET))) +
geom_density_ridges(alpha=0.7) +
labs(title="Income Distribution by Default Status")
credit %>%
ggplot(aes(x = AMT_INCOME_TOTAL, y = factor(TARGET), fill = factor(TARGET))) +
geom_density_ridges(alpha=0.7) +
scale_x_log10() +
labs(title="Income Distribution by Default Status")
credit %>%
group_by(HOUSING_TYPE_OWN) %>%
summarise(default_rate = mean(TARGET)) %>%
ggplot(aes(x=factor(HOUSING_TYPE_OWN), y=default_rate)) +
geom_col() +
labs(title="Default Rate by Housing Ownership")
credit %>%
filter(TARGET == 1) %>%
count(FLAG_OWN_CAR) %>%
mutate(prop = n / sum(n))
credit %>%
group_by(FAMILY_STATUS_MARRIED) %>%
summarise(default_rate = mean(TARGET)) %>%
ggplot(aes(x=factor(FAMILY_STATUS_MARRIED), y=default_rate)) +
geom_col() +
labs(title="Default Rate by Family Status",
y="Default Rate", x="Married Status (1 = Yes)")
credit %>%
mutate(CREDIT_INCOME_RATIO = AMT_CREDIT / AMT_INCOME_TOTAL) %>%
ggplot(aes(x=CREDIT_INCOME_RATIO, fill=factor(TARGET))) +
geom_density(alpha=0.5) +
xlim(0, 5) +
labs(title="Credit-to-Income Ratio by Default Status",
fill="Default (TARGET)")
credit %>%
mutate(EMPLOYED_YEARS = abs(DAYS_EMPLOYED) / 365) %>%
ggplot(aes(x=EMPLOYED_YEARS, fill=factor(TARGET))) +
geom_histogram(position="identity", bins=40, alpha=0.5) +
labs(title="Years Employed vs Default")
credit %>%
group_by(CNT_CHILDREN) %>%
summarise(default_rate = mean(TARGET)) %>%
ggplot(aes(x=factor(CNT_CHILDREN), y=default_rate)) +
geom_col() +
labs(title="Default Rate by Count of Children")
credit %>%
group_by(CNT_CHILDREN) %>%
summarise(default_rate = mean(TARGET)) %>%
ggplot(aes(x=factor(CNT_CHILDREN), y=default_rate)) +
geom_col() +
labs(title="Default Rate by Count of Children",
ylab = "Default Rate")
credit %>%
group_by(CNT_CHILDREN) %>%
summarise(default_rate = mean(TARGET)) %>%
ggplot(aes(x=factor(CNT_CHILDREN), y=default_rate)) +
geom_col() +
labs(title="Default Rate by Count of Children",
y = "Default Rate")
credit %>%
group_by(CNT_CHILDREN) %>%
summarise(default_rate = mean(TARGET)) %>%
ggplot(aes(x=factor(CNT_CHILDREN), y=default_rate)) +
geom_col() +
labs(title="Default Rate by Count of Children",
x = Number of Children,
credit %>%
group_by(CNT_CHILDREN) %>%
summarise(default_rate = mean(TARGET)) %>%
ggplot(aes(x=factor(CNT_CHILDREN), y=default_rate)) +
geom_col() +
labs(title="Default Rate by Count of Children",
x = "Number of Children",
y = "Default Rate")
credit %>%
group_by(CNT_CHILDREN) %>%
summarise(default_rate = mean(TARGET)) %>%
ggplot(aes(x=factor(CNT_CHILDREN), y=default_rate)) +
geom_col() +
labs(title="Default Rate by Number of Children",
x = "Number of Children",
y = "Default Rate")
credit |>
mutate(
Education = case_when(
EDUCATION_TYPE_HIGHER == 1 ~ "Higher",
EDUCATION_TYPE_SECONDARY == 1 ~ "Secondary",
TRUE ~ "Other"
)
) |>
group_by(Education) |>
summarise(default_rate = mean(TARGET)) |>
ggplot(aes(x = Education, y = default_rate, fill = Education)) +
geom_col() +
labs(title = "Default Rate by Education Level",
y = "Default Rate") +
theme_minimal()
credit %>%
group_by(CNT_CHILDREN) |>
summarise(default_rate = mean(TARGET)) |>
ggplot(aes(x=factor(CNT_CHILDREN), y=default_rate)) +
geom_col() +
labs(title="Default Rate by Number of Children",
x = "Number of Children",
y = "Default Rate")
credit |>
mutate(
Education = case_when(
EDUCATION_TYPE_HIGHER == 1 ~ "Higher",
EDUCATION_TYPE_SECONDARY == 1 ~ "Secondary",
TRUE ~ "Other"
)
) |>
group_by(Education) |>
summarise(default_rate = mean(TARGET)) |>
ggplot(aes(x = Education, y = default_rate, fill = Education)) +
geom_col() +
labs(title = "Default Rate by Education Level",
y = "Default Rate") +
theme_minimal()
credit %>%
group_by(CNT_CHILDREN) |>
summarise(default_rate = mean(TARGET)) |>
ggplot(aes(x=factor(CNT_CHILDREN), y=default_rate)) +
labs(title="Default Rate by Number of Children",
x = "Number of Children",
y = "Default Rate")
credit %>%
group_by(CNT_CHILDREN) |>
summarise(default_rate = mean(TARGET)) |>
ggplot(aes(x=factor(CNT_CHILDREN), y=default_rate)) +
geom_col() +
labs(title="Default Rate by Number of Children",
x = "Number of Children",
y = "Default Rate")
credit %>%
group_by(CNT_CHILDREN) |>
summarise(default_rate = mean(TARGET)) |>
ggplot(aes(x=factor(CNT_CHILDREN), y=default_rate, fill = factor(CNT_CHILDREN))) +
geom_col() +
labs(title="Default Rate by Number of Children",
x = "Number of Children",
y = "Default Rate")
credit |>
mutate(
Education = case_when(
EDUCATION_TYPE_HIGHER == 1 ~ "Higher",
EDUCATION_TYPE_SECONDARY == 1 ~ "Secondary"
)
) |>
group_by(Education) |>
summarise(default_rate = mean(TARGET)) |>
ggplot(aes(x = Education, y = default_rate, fill = Education)) +
geom_col() +
labs(title = "Default Rate by Education Level",
y = "Default Rate") +
theme_minimal()
credit |>
mutate(
Education = case_when(
EDUCATION_TYPE_HIGHER == 1 ~ "Higher",
EDUCATION_TYPE_SECONDARY == 1 ~ "Secondary",
TRUE ~ "Other"
)
) |>
group_by(Education) |>
summarise(default_rate = mean(TARGET)) |>
ggplot(aes(x = Education, y = default_rate, fill = Education)) +
geom_col() +
labs(title = "Default Rate by Education Level",
y = "Default Rate") +
theme_minimal()
credit |>
mutate(
Education = case_when(
EDUCATION_TYPE_HIGHER == 1 ~ "Higher",
EDUCATION_TYPE_SECONDARY == 1 ~ "Secondary",
TRUE ~ "Other"
)
) |>
group_by(Education) |>
summarise(default_rate = mean(TARGET)) |>
ggplot(aes(x = Education, y = default_rate, fill = Education)) +
geom_col() +
labs(title = "Default Rate by Education Level",
y = "Default Rate") +
theme_minimal()
credit |>
group_by(NAME_INCOME_TYPE) |>
summarise(default_rate = mean(TARGET)) |>
ggplot(aes(x = reorder(NAME_INCOME_TYPE, default_rate),
y = default_rate)) +
geom_col(fill = "steelblue") +
coord_flip() +
labs(title = "Default Rate by Income Type",
x = "Income Type",
y = "Default Rate") +
theme_minimal()
credit |>
mutate(
Education = case_when(
EDUCATION_TYPE_HIGHER == 1 ~ "Higher",
EDUCATION_TYPE_SECONDARY == 1 ~ "Secondary",
EDUCATION_TYPE_SECONDARY == 1 ~ "Other"
)
) |>
group_by(Education) |>
summarise(default_rate = mean(TARGET)) |>
ggplot(aes(x = Education, y = default_rate, fill = Education)) +
geom_col() +
labs(title = "Default Rate by Education Level",
y = "Default Rate") +
theme_minimal()
credit |>
mutate(
Education = case_when(
EDUCATION_TYPE_HIGHER == 1 ~ "Higher",
EDUCATION_TYPE_SECONDARY == 1 ~ "Secondary",
TRUE ~ "Other"
)
) |>
group_by(Education) |>
summarise(default_rate = mean(TARGET)) |>
ggplot(aes(x = Education, y = default_rate, fill = Education)) +
geom_col() +
labs(title = "Default Rate by Education Level",
y = "Default Rate") +
theme_minimal()
credit |>
count(TARGET) |>
ggplot(aes(x=factor(TARGET), y=n)) +
geom_col() +
geom_text(aes(label=n), vjust=-0.5)
credit |>
mutate(CREDIT_INCOME = AMT_CREDIT / AMT_INCOME_TOTAL) |>
ggplot(aes(x = CREDIT_INCOME, fill=factor(TARGET))) +
geom_density(alpha=0.5) +
xlim(0,4) +
labs(title="Credit/Income Ratio by Default Status")
credit |>
mutate(
DAYS_EMPLOYED_CLEAN = ifelse(DAYS_EMPLOYED == 365243, NA, DAYS_EMPLOYED),
EMPLOYED_YEARS = abs(DAYS_EMPLOYED_CLEAN) / 365
) |>
ggplot(aes(x = EMPLOYED_YEARS, fill = factor(TARGET))) +
geom_histogram(position = "identity", bins = 40, alpha = 0.5) +
labs(title = "Years Employed vs Default Status",
x = "Years Employed",
y = "Count",
fill = "Default (TARGET)") +
xlim(0, 40) +   # trims extreme outliers to improve view
theme_minimal()
credit |>
mutate(
DAYS_EMPLOYED_CLEAN = ifelse(DAYS_EMPLOYED == 365243, NA, DAYS_EMPLOYED),
EMPLOYED_YEARS = abs(DAYS_EMPLOYED_CLEAN) / 365
) |>
ggplot(aes(x = EMPLOYED_YEARS, fill = factor(TARGET))) +
geom_histogram(position = "identity", bins = 40, alpha = 0.5) +
labs(title = "Years Employed vs Default Status",
x = "Years Employed",
y = "Count",
fill = "Default (TARGET)") +
xlim(0, 30) +   # trims extreme outliers to improve view
theme_minimal()
credit |>
mutate(
DAYS_EMPLOYED_CLEAN = ifelse(DAYS_EMPLOYED == 365243, NA, DAYS_EMPLOYED),
EMPLOYED_YEARS = abs(DAYS_EMPLOYED_CLEAN) / 365) |>
ggplot(aes(x = EMPLOYED_YEARS, fill = factor(TARGET))) +
geom_histogram(position = "identity", bins = 40, alpha = 0.5) +
labs(title = "Years Employed vs Default Status",
x = "Years Employed",
y = "Count",
fill = "Default (TARGET)") +
xlim(0, 30) +
theme_minimal()
credit |>
mutate(
DAYS_EMPLOYED_CLEAN = ifelse(DAYS_EMPLOYED == 365243, NA, DAYS_EMPLOYED),
EMPLOYED_YEARS = abs(DAYS_EMPLOYED_CLEAN) / 365,
EMPLOYMENT_GROUP = case_when(
EMPLOYED_YEARS < 1 ~ "<1 year",
EMPLOYED_YEARS < 3 ~ "1-3 years",
EMPLOYED_YEARS < 10 ~ "3-10 years",
TRUE ~ "10+ years"
)
) |>
group_by(EMPLOYMENT_GROUP) |>
summarise(default_rate = mean(TARGET)) |>
ggplot(aes(x = EMPLOYMENT_GROUP, y = default_rate, fill = EMPLOYMENT_GROUP)) +
geom_col() +
labs(title = "Default Rate by Employment Group",
x = "Employment Duration",
y = "Default Rate") +
theme_minimal() +
theme(legend.position = "none")
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(dplyr)
# load dataframe
all_credit <- read_csv(here::here("Data", "application_train.csv"))
# aggregate documents flagged, one-hot-encode, and select columns,
credit <- all_credit %>%
mutate(
DOCUMENTS_FLAGGED = rowSums(select(., starts_with("FLAG_DOCUMENT")))
) %>%
mutate(
CONTRACT_TYPE_CASH = ifelse(NAME_CONTRACT_TYPE=="Cash loans", 1, 0),
CONTRACT_TYPE_REVOLVING = ifelse(NAME_CONTRACT_TYPE=="Revolving loans", 1, 0),
EDUCATION_TYPE_SECONDARY = ifelse(NAME_EDUCATION_TYPE=="Secondary / secondary special", 1, 0),
EDUCATION_TYPE_HIGHER = ifelse(NAME_EDUCATION_TYPE=="Higher education", 1, 0),
EDUCATION_TYPE_OTHER = ifelse(!NAME_EDUCATION_TYPE %in% c("Secondary / secondary special", "Higher education"), 1, 0),
FAMILY_STATUS_MARRIED = ifelse(NAME_FAMILY_STATUS=="Married", 1, 0),
FAMILY_STATUS_SINGLE = ifelse(NAME_FAMILY_STATUS=="Single / not married", 1, 0),
FAMILY_STATUS_OTHER = ifelse(!NAME_FAMILY_STATUS %in% c("Married", "Single / not married"), 1, 0),
HOUSING_TYPE_OWN = ifelse(NAME_HOUSING_TYPE=="House / apartment", 1, 0),
HOUSING_TYPE_PARENTS = ifelse(NAME_HOUSING_TYPE=="With parents", 1, 0),
HOUSING_TYPE_OTHER = ifelse(!NAME_HOUSING_TYPE %in% c("House / apartment", "With parents"), 1, 0),
FLAG_OWN_CAR = ifelse(FLAG_OWN_CAR =="Y", 1, 0),
FLAG_OWN_REALTY = ifelse(FLAG_OWN_REALTY=="Y", 1, 0)
) %>%
select (
SK_ID_CURR,
CONTRACT_TYPE_CASH,
CONTRACT_TYPE_REVOLVING,
FLAG_OWN_CAR,
FLAG_OWN_REALTY,
CNT_CHILDREN,
AMT_INCOME_TOTAL,
AMT_CREDIT,
AMT_ANNUITY,
AMT_GOODS_PRICE,
EDUCATION_TYPE_SECONDARY,
EDUCATION_TYPE_HIGHER,
EDUCATION_TYPE_OTHER,
FAMILY_STATUS_MARRIED,
FAMILY_STATUS_SINGLE,
FAMILY_STATUS_OTHER,
HOUSING_TYPE_OWN,
HOUSING_TYPE_PARENTS,
HOUSING_TYPE_OTHER,
DAYS_EMPLOYED,
DOCUMENTS_FLAGGED,
TARGET
)
head(credit)
credit %>%
group_by(CNT_CHILDREN) |>
summarise(default_rate = mean(TARGET)) |>
ggplot(aes(x=factor(CNT_CHILDREN), y=default_rate, fill = factor(CNT_CHILDREN))) +
geom_col() +
labs(title="Default Rate by Number of Children",
x = "Number of Children",
y = "Default Rate")
credit |>
mutate(
Education = case_when(
EDUCATION_TYPE_HIGHER == 1 ~ "Higher",
EDUCATION_TYPE_SECONDARY == 1 ~ "Secondary",
TRUE ~ "Other"
)
) |>
group_by(Education) |>
summarise(default_rate = mean(TARGET)) |>
ggplot(aes(x = Education, y = default_rate, fill = Education)) +
geom_col() +
labs(title = "Default Rate by Education Level",
y = "Default Rate") +
theme_minimal()
